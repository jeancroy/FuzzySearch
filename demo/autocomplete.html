<!DOCTYPE html>
<html>
<head lang="en">

    <meta charset="UTF-8">
    <title></title>

    <link href="demo.css" rel="stylesheet" type="text/css" />

    <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/typeahead.js/0.11.1/typeahead.jquery.min.js"></script>

    <script src="../dist/FuzzySearch.min.js"></script>
    <!--script src="../src/FuzzySearch.js"></script-->
    <script src="../dist/Highlight.FS.min.js"></script>


</head>
<body>


<h1>FuzzySearch Demo</h1>

<p>Demo page for <a href="https://github.com/jeancroy/FuzzySearch">FuzzySearch Suggestion engine</a>. </p>
<p>Want a minimal setup demo? it's  <a href="https://rawgit.com/jeancroy/FuzzySearch/master/demo/simple.html">here</a>. </p>



<h2>Using Twitter Typeahead</h2>

<div class="typeahead">
    <input id="demo-query" class="twitter-typeahead" name="demo-query" autocomplete="off" type="text">
</div>


<h2>Using Jquery UI Autocomplete</h2>

<div class="typeahead">
    <input id="demo-query-ui-auto" class="twitter-typeahead" name="demo-query-ui-auto" autocomplete="off" type="text">
</div>



<form>
        <h2>Dataset</h2>

        <div style="text-align: left; display:block; width:90%; max-width:400px; margin:auto" >

            <label><input type="radio" name="source" value="small" checked/> Small book dataset, <a href="books.json">about
                2kb</a>* </label><br>

            <label><input type="radio" name="source" value="medium"/> Medium movie dataset, list of title <a href="movies.json">about
                20kb</a> </label><br>


            <label><input type="radio" name="source" value="large"/> Large book dataset, <a href="books_large.json">about
                220kb</a> </label><br><br>


            <div>
                * small book dataset is provided for comparison against a good edit distance implementation <a href="http://kiro.me/projects/fuse.html">fuse.js</a> (or <a href="http://kiro.me/exp/fuse.html">demo</a>)
            </div>

        </div>

        <h2>Options</h2>

        <label> <input type="checkbox" name="free" id="free" checked /> Enable per token score </label><br>
        <table style="text-align: left; display:block; width:90%; margin:auto; max-width:600px;vertical-align: top;margin-top:0">
            <tr><td><strong>Enable:</strong></td><td>Allow free word order, try to respect word boundary &amp;  match start of words, Different words can match different fields. Friendlier for complete sentences !</td></tr>
            <tr><td><strong>Disable:</strong></td><td>Very fast ! Match whole query against whole field. All character in order, score best field for each item. If your dataset have one word per item, (or one word per field) this might be the best option for you</td></tr>
        </table>

        <br><br>
        <label> <input type="checkbox" name="fused" id="fused" /> Enable fused score </label><br>
        (Test an extra possibility where both string matches without token boundary. eg "oldmanwar" matches "old man war")

</form>



<!-- allow to scroll so autocomplete is at top of page -->
<div style="height: 500px;"></div>

<script>

    //
    // Create main object
    // We will fill the data once we have the JSON loaded
    //

    var fuzzyhound = new FuzzySearch({output_limit: 6, output_map:"alias"});

    // output_limit: number of item to return
    //
    // output_map:"alias" : Build a custom output object.
    //                      This can be used to reuse same template with different source format
    //                      Input - Output mapping is set using keys options see "Dataset switch UI" below


    // - - - - - - - - - - - - - - - - - - - - - - -
    //    Item template, shared for both auto-completes
    // - - - - - - - - - - - - - - - - - - - - - - -

    function itemTemplate(suggestion) {

        //This template is the same despite the fact source input change format.
        //This is because we use alias option to transform output.

        return [
            "<div>",
            "<span class='title'>\"", fuzzyhound.highlight(suggestion.title), "\"</span>",
            "<span class='author'>", (suggestion.author)? " by " + fuzzyhound.highlight(suggestion.author): "" , "</span>",
            "<span class='score' title='", suggestion._match ,"'>(&nbsp;", suggestion._score.toFixed(2), "&nbsp;)</span>",
            "</div>"
        ].join("");

    }

    //
    // Use footer to show some performance stats
    //

    function footerTemplate() {
        var render_end = performance.now();
        return "<div class='typeahead-footer'> " +
                "Search took <strong>" + fuzzyhound.search_time.toFixed(3) + " ms</strong><br>" +
                "Total (search+highlight+render):  <strong>" + (render_end - fuzzyhound.start_time).toFixed(3) + " ms</strong><br>" +
                "Query: <strong>" + fuzzyhound.query.normalized.length + "</strong> chars <br>" +
                "Source contain " + fuzzyhound.source.length + " Items<br>" +
                "</div>";
    }

    //- - - - - - - - - - -
    //   Typeahead Setup
    // - - - - - - - - - - -

    $('#demo-query').typeahead({
                minLength: 2,
                highlight: false //we'll use FuzzySearch highlight instead
            },
            {
                name: 'books',
                limit: 100, // let fuzzyhound.output_limit apply limit
                source: fuzzyhound,
                display: "item.title",
                templates: {
                    suggestion: itemTemplate,
                    footer: footerTemplate,
                    pending: ""
                }

            }).bind('typeahead:select', function (ev, suggestion) {
                alert('Selection: ' + suggestion.item.title);
            });


    //- - - - - - - - - - -
    //    Jquery UI Setup
    // - - - - - - - - - - -

    var jq_auto =
            $("#demo-query-ui-auto").autocomplete({
                minLength: 2,
                delay: 150,
                source: function (request, response) {
                    response(fuzzyhound.search(request.term));
                },
                messages: {
                    noResults: '',
                    results: function () {
                    }
                }

            });

    //Get instance to extend
    var jq_instance = jq_auto.autocomplete("instance");

    //Custom item
    jq_instance._renderItem = function (ul, item) {
        return $("<li>").append(itemTemplate(item)).appendTo(ul);
    };

    //Custom footer
    jq_instance._renderMenu = function (ul, items) {
        var nbitems = items.length, i = -1;
        while (++i < nbitems) {
            var display = items[i].item.title;
            this._renderItem(ul, items[i])
                    .data("ui-autocomplete-item",
                    {display: display, value: display});
        }
        $("<li>").append(footerTemplate()).data("ui-autocomplete-item", {display: "", value: ""}).appendTo(ul);
    };


    // - - - - - - - - - - - -
    //   Setup dataset switch
    //- - - - - - - - - - - - -

    $.ajaxSetup({cache: true});
    function setsource(url, keys) {
        $.getJSON(url).then(function (response) {
            fuzzyhound.setOptions({
                source: response,
                keys: keys
            })
        });
    }

    //Load small dataset by default
    setsource("books.json", ["title", "author"]);

    // - - - - - - - - - - - -
    //   Dataset switch UI
    //- - - - - - - - - - - - -

    $('input[name=source]:radio').change(function () {

        switch (this.value) {

            case "large":
                setsource("books_large.json", {title:"title", author:"authors.author"} );
                break;

            case "medium":
                setsource("movies.json", {title:"."} ); //Movie is a list of title. Set output.title to the item
                break;

            case "small":
            default:
                setsource("books.json", ["title", "author"]);
                break;
        }


    });

    $('#free').change(function () {
        fuzzyhound.setOptions({
            score_per_token: $(this).is(":checked")
        })
    });

    $('#fused').change(function () {
        fuzzyhound.setOptions({
            score_test_fused: $(this).is(":checked")
        });
    })



</script>


</body>
</html>