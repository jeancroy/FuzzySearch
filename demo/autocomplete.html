<!DOCTYPE html>
<html>
<head lang="en">

    <meta charset="UTF-8">
    <title></title>

    <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/typeahead.js/0.11.1/typeahead.jquery.min.js"></script>
    <script src="../src/FuzzySearch.js"></script>


</head>
<body class="home">

<style>

    .twitter-typeahead, .twitter-typeahead input {
        width: 500px;
        padding: 10px;
        display: inline-block;
    }

    .title {
        color: #222;
    }

    .title strong {
        color: #000;
    }

    .author {
        color: #666
    }

    .author strong {
        color: #444
    }

    .score {
        color: #888;
    }

    .hh {
        background-color: yellow;
    }

</style>

<h1>FuzzySearch Demo</h1>
Demo page for <a href="https://github.com/jeancroy/FuzzySearch">FuzzySearch Suggestion engine</a>. <br/>

<h2>Dataset</h2>
<form>
    <label><input type="radio" name="source" value="small" checked/> Small book dataset, <a href="books.json">about 2kb</a> </label>
    <label><input type="radio" name="source" value="large"/> Large book dataset, <a href="books_large.json">about 220kb</a> </label>
</form>

<h2>Using Twitter Typeahead</h2>

<input id="demo-query" name="demo-query" autocomplete="off" type="text" width="500px">


<script>


        var fuzzyhound = new FuzzySearch();

        $('#demo-query').typeahead({
                    minLength: 2,
                    highlight: false //we'll use FuzzySearch highlight instead
                },
                {
                    name: 'task',
                    limit:6,
                    source: fuzzyhound,
                    display: "item.title",
                    templates: {
                        suggestion: function (suggestion) {
                            var item = suggestion.item;
                            var query = suggestion._query;
                            var author = item.author || item.authors.author;

                            if ( Object.prototype.toString.call(author) === '[object Array]' ) {
                                author =  author.join(", ");
                            }

                            return [

                                "<div>",
                                "<span class='title'>\"", fuzzyhound.highlight(query, item.title), "</span>\" by <span class='author'>", fuzzyhound.highlight(query, author), "</span>",
                                "<span class='score'>(&nbsp;", suggestion.score.toFixed(2), "&nbsp;)</span><br><br>",
                                "</div>"

                            ].join("");
                        },
                        notFound: function (context) {
                            return "<div class='typeahead-empty'> No result for \"" + context.query + "\"</div>"
                        },
                        footer: function(context){
                            var render_end = performance.now();
                            var str =  "<div class='typeahead-footer'> " +
                                    "<br>"+
                                    "Search took <strong>" + fuzzyhound.search_time.toFixed(3) + " ms</strong><br>" +
                                    "Total (search+highlight+render):  <strong>" + (render_end - fuzzyhound.start_time).toFixed(3) + " ms</strong><br>" +
                                    "Source contain " + fuzzyhound.source.length + " Items<br>" +
                                    "Showing the bests out of " + fuzzyhound.results.length + " positive candidate<br>" +
                                    "</div>";
                            return str;

                        }
                    }


                }).bind('typeahead:select', function (ev, suggestion) {
                    alert('Selection: ' + suggestion.item.title);
                });


        //Setup dataset switch
        $.ajaxSetup({cache: true});

        function setsource(url,keys){
            $.getJSON(url).then(function (response) {
                    fuzzyhound.set({
                        source: response,
                        keys: keys
                    })
                });
        }

        //Load small dataset by default
        setsource("books.json",["title", "author"]);

        $('input[name=source]:radio').change(function(){
            switch(this.value){

                case "large":
                    setsource("books_large.json",["title", "authors.author"]);
                    break;

                case "small":
                default:
                    setsource("books.json",["title", "author"]);
                    break;
            }

            el = $('#demo-query');
            el.typeahead('val', el.typeahead('val') );

        });





</script>


</body>
</html>